(function(h,s,u,t,p,R,E,$,d,F,i){"use strict";const{ActionSheetRow:y}=u.findByProps("ActionSheetRow"),{FormRow:w}=u.findByProps("FormRow");function A(a){let{label:l,icon:e,onPress:n}=a;const c=t.stylesheet.createThemedStyleSheet({iconComponent:{width:24,height:24,tintColor:d.semanticColors.INTERACTIVE_NORMAL}});return y?React.createElement(y,{label:l,icon:React.createElement(y.Icon,{source:e,IconComponent:function(){return React.createElement(t.ReactNative.Image,{resizeMode:"cover",style:c.iconComponent,source:e})}}),onPress:n}):React.createElement(w,{label:l,leading:React.createElement(w.Icon,{source:e}),onPress:n})}const C=u.findByProps("openLazy","hideActionSheet"),_=/^```(?:json)\n([\s\S]*?)```$/gm,I=R.getAssetIDByName("ic_download_24px");function M(){return p.before("openLazy",C,function(a){let[l,e]=a;e==="MessageLongPressActionSheet"&&l.then(function(n){const c=p.after("default",n,function(g,o){let[{message:ae}]=g;t.React.useEffect(function(){return function(){c()}},[]);const v=ae.content.match(_)?.map(function(r){return r.slice(7,r.length-3)}).map(function(r){try{return JSON.parse(r)}catch{return}}).filter(function(r){return r}).filter(function(r){return typeof r.name=="string"&&r.name&&typeof r.match=="string"&&typeof r.replace=="string"&&typeof r.flags=="string"&&typeof r.regex=="boolean"});if(!v||v.length==0)return;const T=$.findInReactTree(o,function(r){return r?.[0]?.type?.name==="ButtonRow"});if(T)for(const r of v){const le=function(){s.storage.rules.push(r),E.showToast(`Imported rule ${r.name}`,I),C.hideActionSheet()},oe=t.React.createElement(A,{icon:I,label:`Import ${r.name}`,onPress:le});T.unshift(oe)}})})})}const B=u.findByProps("sendMessage","receiveMessage"),D=R.getAssetIDByName("ic_warning_24px");function L(){return p.before("sendMessage",B,function(a){const l=s.storage.rules.filter(function(n){return n.match});let e=a[1].content;for(const n of l)if(n.regex)try{const c=new RegExp(n.match,n.flags);e=e.replace(c,n.replace)}catch(c){console.log(c),E.showToast(`Failed to use RegExp for ${n.name}!`,D);continue}else e=e.replaceAll(n.match,n.replace);a[1].content=e})}const{TouchableOpacity:O}=i.General,{FormIcon:V}=i.Forms,z=R.getAssetIDByName("ic_add_24px");function j(a){let{onPress:l}=a;return React.createElement(O,{onPress:l},React.createElement(V,{source:z,style:{marginRight:-8,marginLeft:8,opacity:1}}))}const{ScrollView:G}=i.General,{FormSection:f,FormInput:m,FormDivider:N,FormSwitchRow:U,FormRow:x,FormLabel:J}=i.Forms,K=R.getAssetIDByName("ic_message_copy"),X=t.stylesheet.createThemedStyleSheet({delete:{color:d.rawColors.RED_400}});function P(a){let{ruleIndex:l}=a,e=s.storage.rules[l];F.useProxy(s.storage);const n=t.NavigationNative.useNavigation(),c=function(){const o=`\`\`\`json
${JSON.stringify(e,null,4)}
\`\`\``;t.clipboard.setString(o),E.showToast(`Copied ${e.name} to Clipboard`,K)},g=function(){s.storage.rules.splice(l,1),n.pop()};return React.createElement(G,null,React.createElement(f,null,React.createElement(m,{value:e?.name,onChange:function(o){return e.name=o},placeholder:"New rule",title:"Name"})),React.createElement(f,null,React.createElement(m,{value:e?.match,onChange:function(o){return e.match=o},placeholder:"foo",title:"Match"}),e?.regex&&React.createElement(React.Fragment,null,React.createElement(N,null),React.createElement(m,{title:"Flags",placeholder:"gi",value:e?.flags,onChange:function(o){return e.flags=o}})),React.createElement(N,null),React.createElement(m,{value:e?.replace,onChange:function(o){return e.replace=o},placeholder:"bar",title:"Replace with"})),React.createElement(f,null,React.createElement(U,{label:"Regular expression",subLabel:"Turn on if your rule is a regular expression",value:e?.regex,onValueChange:function(o){return e.regex=o}})),React.createElement(f,null,React.createElement(x,{label:"Copy code block to Clipboard",onPress:c})),React.createElement(f,null,React.createElement(x,{label:React.createElement(J,{text:"Delete Rule",style:X.delete}),onPress:g})))}const{FormRow:Y,FormArrow:k}=i.Forms;function H(a){let{rule:l,index:e}=a;const n=t.NavigationNative.useNavigation();return React.createElement(Y,{label:l.name,trailing:React.createElement(k,null),onPress:function(){return n.push("VendettaCustomPage",{title:"Editing Rule",render:function(){return React.createElement(P,{ruleIndex:e})}})}})}const{ScrollView:q,TextInput:Q}=i.General,{FormRow:W,FormSection:Z,FormDivider:ee}=i.Forms,S=t.stylesheet.createThemedStyleSheet({input:{fontSize:16,fontFamily:t.constants.Fonts.PRIMARY_MEDIUM,color:d.semanticColors.TEXT_NORMAL},placeholder:{color:d.semanticColors.INPUT_PLACEHOLDER_TEXT}}),te=u.findByName("useIsFocused");function ne(){const[a,l]=t.React.useState("");let e=s.storage.rules;F.useProxy(s.storage);const n=t.NavigationNative.useNavigation();te();const c=function(){a&&(e.push({name:a.trim(),match:"",flags:"gi",replace:"",regex:!1}),l(""),n.push("VendettaCustomPage",{title:"Editing Rule",render:function(){return t.React.createElement(P,{ruleIndex:e.length-1})}}))};return t.React.createElement(q,null,t.React.createElement(Z,{title:"Rules"},e.map(function(g,o){return t.React.createElement(t.React.Fragment,null,t.React.createElement(H,{rule:g,index:o}),t.React.createElement(ee,null))}),t.React.createElement(W,{label:t.React.createElement(Q,{value:a,onChangeText:l,placeholder:"New rule",placeholderTextColor:S.placeholder.color,selectionColor:t.constants.Colors.PRIMARY_DARK_100,onSubmitEditing:c,returnKeyType:"done",style:S.input}),trailing:t.React.createElement(j,{onPress:c})})))}let b;var re={onLoad:function(){s.storage.rules??=[],b=[L(),M()]},onUnload:function(){for(const a of b)a()},settings:ne};return h.default=re,Object.defineProperty(h,"__esModule",{value:!0}),h})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui.assets,vendetta.ui.toasts,vendetta.utils,vendetta.ui,vendetta.storage,vendetta.ui.components);
