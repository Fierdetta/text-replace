(function(h,s,u,t,m,d,i,p,v,E){"use strict";const N=u.findByProps("openLazy","hideActionSheet"),{FormRow:C}=i.Forms,S=u.findByName("Icon"),I=/^```(?:json)\n([\s\S]*?)```$/gm,x=d.getAssetIDByName("ic_download_24px");function T(){return m.before("openLazy",N,function(a){let[c,e]=a;e==="MessageLongPressActionSheet"&&c.then(function(n){const o=m.after("default",n,function(g,l){let[{message:te}]=g;t.React.useEffect(function(){return function(){o()}},[]);const y=te.content.match(I)?.map(function(r){return r.slice(7,r.length-3)}).map(function(r){try{return JSON.parse(r)}catch{return}}).filter(function(r){return r}).filter(function(r){return typeof r.name=="string"&&r.name&&typeof r.match=="string"&&typeof r.replace=="string"&&typeof r.flags=="string"&&typeof r.regex=="boolean"});if(!y||y.length==0)return;let ne=l?.props?.children?.props?.children?.props?.children[1];for(const r of y){const re=function(){s.storage.rules.push(r),p.showToast(`Imported rule ${r.name}`,x),N.hideActionSheet()},ae=t.React.createElement(C,{leading:t.React.createElement(S,{source:x}),label:`Import ${r.name}`,onPress:re});ne.unshift(ae)}})})})}const _=u.findByProps("sendMessage","receiveMessage"),A=d.getAssetIDByName("ic_warning_24px");function D(){return m.before("sendMessage",_,function(a){const c=s.storage.rules.filter(function(n){return n.match});let e=a[1].content;for(const n of c)if(n.regex)try{const o=new RegExp(n.match,n.flags);e=e.replace(o,n.replace)}catch(o){console.log(o),p.showToast(`Failed to use RegExp for ${n.name}!`,A);continue}else e=e.replaceAll(n.match,n.replace);a[1].content=e})}const{TouchableOpacity:M}=i.General,L=u.findByName("Icon"),B=d.getAssetIDByName("ic_add_24px");function O(a){let{onPress:c}=a;return React.createElement(M,{onPress:c},React.createElement(L,{source:B,style:{marginRight:-8,marginLeft:8}}))}const{ScrollView:V}=i.General,{FormSection:f,FormInput:R,FormDivider:F,FormSwitchRow:j,FormRow:P,FormLabel:z}=i.Forms,G=d.getAssetIDByName("ic_message_copy"),U=t.stylesheet.createThemedStyleSheet({delete:{color:E.rawColors.RED_400}});function $(a){let{ruleIndex:c}=a,e=s.storage.rules[c];v.useProxy(s.storage);const n=t.NavigationNative.useNavigation(),o=function(){const l=`\`\`\`json
${JSON.stringify(e,null,4)}
\`\`\``;t.clipboard.setString(l),p.showToast(`Copied ${e.name} to Clipboard`,G)},g=function(){s.storage.rules.splice(c,1),n.pop()};return React.createElement(V,null,React.createElement(f,null,React.createElement(R,{value:e?.name,onChange:function(l){return e.name=l},placeholder:"New rule",title:"Name"})),React.createElement(f,null,React.createElement(R,{value:e?.match,onChange:function(l){return e.match=l},placeholder:"foo",title:"Match"}),e?.regex&&React.createElement(React.Fragment,null,React.createElement(F,null),React.createElement(R,{title:"Flags",placeholder:"gi",value:e?.flags,onChange:function(l){return e.flags=l}})),React.createElement(F,null),React.createElement(R,{value:e?.replace,onChange:function(l){return e.replace=l},placeholder:"bar",title:"Replace with"})),React.createElement(f,null,React.createElement(j,{label:"Regular expression",subLabel:"Turn on if your rule is a regular expression",value:e?.regex,onValueChange:function(l){return e.regex=l}})),React.createElement(f,null,React.createElement(P,{label:"Copy code block to Clipboard",onPress:o})),React.createElement(f,null,React.createElement(P,{label:React.createElement(z,{text:"Delete Rule",style:U.delete}),onPress:g})))}const{FormRow:J,FormArrow:K}=i.Forms;function X(a){let{rule:c,index:e}=a;const n=t.NavigationNative.useNavigation();return React.createElement(J,{label:c.name,trailing:React.createElement(K,null),onPress:function(){return n.push("VendettaCustomPage",{title:"Editing Rule",render:function(){return React.createElement($,{ruleIndex:e})}})}})}const{ScrollView:Y,TextInput:k}=i.General,{FormRow:H,FormSection:q,FormDivider:Q}=i.Forms,b=t.stylesheet.createThemedStyleSheet({input:{fontSize:16,fontFamily:t.constants.Fonts.PRIMARY_MEDIUM,color:E.semanticColors.TEXT_NORMAL},placeholder:{color:E.semanticColors.INPUT_PLACEHOLDER_TEXT}}),W=u.findByName("useIsFocused");function Z(){const[a,c]=t.React.useState("");let e=s.storage.rules;v.useProxy(s.storage);const n=t.NavigationNative.useNavigation();W();const o=function(){a&&(e.push({name:a.trim(),match:"",flags:"gi",replace:"",regex:!1}),c(""),n.push("VendettaCustomPage",{title:"Editing Rule",render:function(){return t.React.createElement($,{ruleIndex:e.length-1})}}))};return t.React.createElement(Y,null,t.React.createElement(q,{title:"Rules"},e.map(function(g,l){return t.React.createElement(t.React.Fragment,null,t.React.createElement(X,{rule:g,index:l}),t.React.createElement(Q,null))}),t.React.createElement(H,{label:t.React.createElement(k,{value:a,onChangeText:c,placeholder:"New rule",placeholderTextColor:b.placeholder.color,selectionColor:t.constants.Colors.PRIMARY_DARK_100,onSubmitEditing:o,returnKeyType:"done",style:b.input}),trailing:t.React.createElement(O,{onPress:o})})))}let w;var ee={onLoad:function(){s.storage.rules??=[],w=[D(),T()]},onUnload:function(){for(const a of w)a()},settings:Z};return h.default=ee,Object.defineProperty(h,"__esModule",{value:!0}),h})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui.assets,vendetta.ui.components,vendetta.ui.toasts,vendetta.storage,vendetta.ui);
