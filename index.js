(function(R,s,m,t,h,g,i,p,v,E){"use strict";const F=m.findByProps("openLazy","hideActionSheet"),{FormRow:C,FormIcon:I}=i.Forms,S=/^```(?:json)\n([\s\S]*?)```$/gm,x=g.getAssetIDByName("ic_download_24px");function T(){return h.before("openLazy",F,function(a){let[c,e]=a;e==="MessageLongPressActionSheet"&&c.then(function(n){const o=h.after("default",n,function(f,l){let[{message:te}]=f;t.React.useEffect(function(){return function(){o()}},[]);const y=te.content.match(S)?.map(function(r){return r.slice(7,r.length-3)}).map(function(r){try{return JSON.parse(r)}catch{return}}).filter(function(r){return r}).filter(function(r){return typeof r.name=="string"&&r.name&&typeof r.match=="string"&&typeof r.replace=="string"&&typeof r.flags=="string"&&typeof r.regex=="boolean"});if(!y||y.length==0)return;let ne=l?.props?.children?.props?.children?.props?.children[1];for(const r of y){const re=function(){s.storage.rules.push(r),p.showToast(`Imported rule ${r.name}`,x),F.hideActionSheet()},ae=t.React.createElement(C,{leading:t.React.createElement(I,{style:{opacity:1},source:x}),label:`Import ${r.name}`,onPress:re});ne.unshift(ae)}})})})}const _=m.findByProps("sendMessage","receiveMessage"),A=g.getAssetIDByName("ic_warning_24px");function D(){return h.before("sendMessage",_,function(a){const c=s.storage.rules.filter(function(n){return n.match});let e=a[1].content;for(const n of c)if(n.regex)try{const o=new RegExp(n.match,n.flags);e=e.replace(o,n.replace)}catch(o){console.log(o),p.showToast(`Failed to use RegExp for ${n.name}!`,A);continue}else e=e.replaceAll(n.match,n.replace);a[1].content=e})}const{TouchableOpacity:M}=i.General,{FormIcon:L}=i.Forms,B=g.getAssetIDByName("ic_add_24px");function O(a){let{onPress:c}=a;return React.createElement(M,{onPress:c},React.createElement(L,{source:B,style:{marginRight:-8,marginLeft:8,opacity:1}}))}const{ScrollView:V}=i.General,{FormSection:u,FormInput:d,FormDivider:N,FormSwitchRow:j,FormRow:$,FormLabel:z}=i.Forms,G=g.getAssetIDByName("ic_message_copy"),U=t.stylesheet.createThemedStyleSheet({delete:{color:E.rawColors.RED_400}});function w(a){let{ruleIndex:c}=a,e=s.storage.rules[c];v.useProxy(s.storage);const n=t.NavigationNative.useNavigation(),o=function(){const l=`\`\`\`json
${JSON.stringify(e,null,4)}
\`\`\``;t.clipboard.setString(l),p.showToast(`Copied ${e.name} to Clipboard`,G)},f=function(){s.storage.rules.splice(c,1),n.pop()};return React.createElement(V,null,React.createElement(u,null,React.createElement(d,{value:e?.name,onChange:function(l){return e.name=l},placeholder:"New rule",title:"Name"})),React.createElement(u,null,React.createElement(d,{value:e?.match,onChange:function(l){return e.match=l},placeholder:"foo",title:"Match"}),e?.regex&&React.createElement(React.Fragment,null,React.createElement(N,null),React.createElement(d,{title:"Flags",placeholder:"gi",value:e?.flags,onChange:function(l){return e.flags=l}})),React.createElement(N,null),React.createElement(d,{value:e?.replace,onChange:function(l){return e.replace=l},placeholder:"bar",title:"Replace with"})),React.createElement(u,null,React.createElement(j,{label:"Regular expression",subLabel:"Turn on if your rule is a regular expression",value:e?.regex,onValueChange:function(l){return e.regex=l}})),React.createElement(u,null,React.createElement($,{label:"Copy code block to Clipboard",onPress:o})),React.createElement(u,null,React.createElement($,{label:React.createElement(z,{text:"Delete Rule",style:U.delete}),onPress:f})))}const{FormRow:J,FormArrow:K}=i.Forms;function X(a){let{rule:c,index:e}=a;const n=t.NavigationNative.useNavigation();return React.createElement(J,{label:c.name,trailing:React.createElement(K,null),onPress:function(){return n.push("VendettaCustomPage",{title:"Editing Rule",render:function(){return React.createElement(w,{ruleIndex:e})}})}})}const{ScrollView:Y,TextInput:k}=i.General,{FormRow:H,FormSection:q,FormDivider:Q}=i.Forms,P=t.stylesheet.createThemedStyleSheet({input:{fontSize:16,fontFamily:t.constants.Fonts.PRIMARY_MEDIUM,color:E.semanticColors.TEXT_NORMAL},placeholder:{color:E.semanticColors.INPUT_PLACEHOLDER_TEXT}}),W=m.findByName("useIsFocused");function Z(){const[a,c]=t.React.useState("");let e=s.storage.rules;v.useProxy(s.storage);const n=t.NavigationNative.useNavigation();W();const o=function(){a&&(e.push({name:a.trim(),match:"",flags:"gi",replace:"",regex:!1}),c(""),n.push("VendettaCustomPage",{title:"Editing Rule",render:function(){return t.React.createElement(w,{ruleIndex:e.length-1})}}))};return t.React.createElement(Y,null,t.React.createElement(q,{title:"Rules"},e.map(function(f,l){return t.React.createElement(t.React.Fragment,null,t.React.createElement(X,{rule:f,index:l}),t.React.createElement(Q,null))}),t.React.createElement(H,{label:t.React.createElement(k,{value:a,onChangeText:c,placeholder:"New rule",placeholderTextColor:P.placeholder.color,selectionColor:t.constants.Colors.PRIMARY_DARK_100,onSubmitEditing:o,returnKeyType:"done",style:P.input}),trailing:t.React.createElement(O,{onPress:o})})))}let b;var ee={onLoad:function(){s.storage.rules??=[],b=[D(),T()]},onUnload:function(){for(const a of b)a()},settings:Z};return R.default=ee,Object.defineProperty(R,"__esModule",{value:!0}),R})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui.assets,vendetta.ui.components,vendetta.ui.toasts,vendetta.storage,vendetta.ui);
